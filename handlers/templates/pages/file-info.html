{{ define "style-tags" }}
{{ end }}

{{ define "script-tags" }}
  <script type="module" nonce="{{ .CspNonce }}">
    const uploadLinksEl = document.querySelector("upload-links");
    const uploadTimestamp = document.getElementById("upload-timestamp");

    function parseTimestamp(raw) {
      // Make sure the timestamp is valid.
      const timestamp = Date.parse(raw);
      if (isNaN(timestamp)) {
        return null;
      }
      // Get the timestamp in local time.
      return new Date(timestamp);
    }

    document.addEventListener("DOMContentLoaded", function () {
      const dateToTime = (date) =>
        date.toLocaleString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "numeric",
          minute: "numeric",
        });
      uploadTimestamp.innerText = dateToTime(
        parseTimestamp(uploadTimestamp.innerText)
      );
      uploadLinksEl.addEventListener("link-copied", () => {
        document
          .querySelector("snackbar-notifications")
          .addInfoMessage("Copied link");
      });
    });
  </script>
{{ end }}

{{ define "custom-elements" }}
  {{ template "upload-link-box.html" . }}
  {{ template "upload-links.html" . }}
{{ end }}

{{ define "content" }}
  <h1 class="title">File Information</h1>

  {{ with .Metadata }}

    <div class="field my-5">
      <label class="label">Links</label>

      <upload-links file-id="{{ .ID }}" filename="{{ .Filename }}">
      </upload-links>
    </div>

    <div class="field my-5">
      <label class="label">Filename</label>
      {{ .Filename }}
    </div>

    <div class="field my-5">
      <label class="label">Size</label>
      <td class="is-vcentered">{{ formatFileSize .Size }}</td>
    </div>

    <div class="field my-5">
      <label class="label">Expires</label>

      {{ formatExpiration .Expires }}
    </div>

    <div class="field my-5">
      <label class="label">Note</label>
      {{ if .Note.Value }}
        {{ .Note }}
      {{ else }}
        None
      {{ end }}
    </div>

    <div class="field my-5">
      <label class="label">Uploaded by</label>
      {{ if .GuestLink.Empty }}
        You
      {{ else }}
        {{ $label := .GuestLink.ID }}
        {{ if not .GuestLink.Label.Empty }}
          {{ $label = .GuestLink.Label }}
        {{ end }}

        Guest link:
        <a href="/g/{{ .GuestLink.ID.String }}">{{ $label.String }}</a>
      {{ end }}
    </div>

    <div class="field my-5">
      <label class="label">Upload time</label>
      <span id="upload-timestamp">{{ formatTimestamp .Uploaded }}</span>
    </div>

    <div class="field is-grouped">
      <div class="control">
        <a href="/files" class="button is-link is-light">Close</a>
      </div>
      <div class="control">
        <a class="button is-link" href="/files/{{ .ID }}/edit">
          <i class="fas fa-edit mr-2"></i>
          Edit</a
        >
      </div>
    </div>
  {{ end }}
{{ end }}

{{ template "base.html" }}
